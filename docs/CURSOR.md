# Rules for Cursor or AI Agents

DO NOT EDIT THIS FILE

## General
- If you are working on OSX, please use a basic bash shell
- If you are working on Windows, please use PowerShell
- You can configure the project build with: cmake -S . -B build
- You can run the build with: cmake --build build -j8
- When you are done working on a file, run clang-format on it

## Working
- The project is not working if the tests are not passing or the tests aren't running to completion
- Do not be afraid to add very verbose debug logging to help you diagnose problems, we can remove it after problems are fixed
- You are not allowed to modify external dependencies (ext/ folder, etc.), even if it's checked into the repo
- (OSX) If you experience crashes and/or need to debug, you can launch and get results from lldb with this oneliner: lldb ./build/test/coro_roro_tests --batch -o 'run' -k 'thread backtrace all' -k 'quit'

## Code Design
- Avoid 2-phase initialisation or destruction with init() or shutdown(), you should use RAII for these
- Be as const as possible all the time
- Be as constexpr as possible all the time

## Style
- Use british english (initialisation over initialization, etc.)
- This is modern C++20 code
- We use smart pointers and RAII, not raw pointers
- Allman style bracing, always uses braces (Opening brace on new line)
- 4-space indentation
- Do not indent inside namespaces
- Trailing return type syntax, unless the function returns void
- After initial iteration, one item per header file (structs, classes, enums, helpers, etc.)
- Exception: Pure virtual interfaces and their single implementation can share a file, named after the implementation
- Multiple macros can exist in the macros header, if needed
- PascalCase for classes, structs, and template parameter names
- camelCase for local variables and member functions
- camelCase_ (note the underscore) for member variables
- Getters should be named for what they are: status() instead of getStatus()
- Setters should say set: setStatus() instead of status() = newStatus;
- For bool lookup flags, don't use "is". running() is preferred to isRunning()
- Don't use raw member access, provide external callers with accessor members like: scheduler.workerPool() that returns a reference to that member
- classes and structs should be marked as final where possible
- enum class is prefered, and should specify the smalles possible underlying type
- Use trailing commas in enums and aggregate initialisation
- Use std::ignore if you need to ignore things
- When using atomics, ALWAYS use .store() and .load(), etc., to clearly signal you're using an atomic.
- No short variable names: std::queue<int> q; is bad, use std::queue<int> workQueue;
- No ligatures(the single character arrow). It's encouraged to use ASCII art: ->, etc.
- "Obvious" functions and helpers like "toString" don't need header comments
- No emojis!
- Constructor parameter ordering : Dependencies first(as references), then data parameters
- Store dependencies first as references in private member variables
- There should always be a newline at the end of the file
- When working with templates and header-only implementations, the struct/class definition should declare everything without the implementation, and then the definitions should be inline at the bottom of the file. Like so:

```cpp
class SomeClass final
{
public:
    void someFunction();
};

//
// inline members
//

inline SomeClass::someFunction()
{
    // ...
}

```

- Header comment formatting
```cpp

//
// ClassName
//
//   Details about the class, other information.
//

class ClassName final
{
    ...
};
```

- Marker/group header formatting
```cpp
class ClassName final
{
pulic:
    //
    // Public-facing API
    //

    void func() ...

    void func() ...

    void func() ...

    //
    // Utility functions
    //

    void func() ...
    
    void func() ...

    void func() ...

private:
    Member& member_;
};

//
// inline members
//

...
```
